{
    "floors": [
        {
            "floor": 1,
            "title": "dungeon.floor1.title",
            "story": "dungeon.floor1.story",
            "schema": "テーブル名: products\n- product_id, name, category, price",
            "solutionPatterns": ["SELECT\\s+name,\\s*price\\s+FROM\\s+products\\s+WHERE\\s*price\\s*>=\\s*1000"],
            "answer": "SELECT name, price FROM products WHERE price >= 1000",
            "borrowed": ["WHERE"],
            "reward": {
                "gold": 100,
                "energy": 5,
                "items": ["WHERE"]
            },
            "hint": "特定の条件に合う行を絞り込むには `WHERE` 句を使う。"
        },
        {
            "floor": 2,
            "title": "集計とGROUP BYの試練",
            "story": "モンスターの巣窟だ。モンスター(monsters)テーブルにて、種族(species)ごとのモンスターの数を数えよ。",
            "schema": "テーブル名: monsters\n- monster_id, name, species, hp",
            "solutionPatterns": ["SELECT\\s+species,\\s*COUNT\\(\\s*(?:\\*|monster_id)\\s*\\)\\s+FROM\\s+monsters\\s+GROUP\\s+BY\\s+species"],
            "answer": "SELECT species, COUNT(*) FROM monsters GROUP BY species",
            "borrowed": ["COUNT", "GROUP", "BY"],
            "reward": {
                "gold": 150,
                "energy": 5,
                "items": ["COUNT", "GROUP", "BY"]
            },
            "hint": "グループごとに集計するには `GROUP BY` 句を使う。"
        },
        {
            "floor": 3,
            "title": "INNER JOINの結合呪文",
            "story": "ギルドの広間だ。社員(employees)と部署(departments)を結合し、各社員の名前(emp_name)と部署名(dept_name)の一覧を作成せよ。",
            "schema": "テーブル名: employees\n- emp_id, emp_name, dept_id\nテーブル名: departments\n- dept_id, dept_name",
            "specialValidation": true,
            "answer": "SELECT emp_name, dept_name FROM employees INNER JOIN departments ON employees.dept_id = departments.dept_id",
            "borrowed": ["INNER", "JOIN", "ON", "AS"],
            "reward": {
                "gold": 200,
                "energy": 5,
                "items": ["INNER", "JOIN", "ON", "AS"]
            },
            "hint": "2つのテーブルを共通の列で結びつけるには `INNER JOIN ... ON ...` を使う。",
            "opensShop": true
        },
        {
            "floor": 4,
            "title": "サブクエリの迷宮",
            "story": "販売履歴(sales)テーブルにある、「開発部」の社員による売上の数量(quantity)の合計を求めよ。",
            "schema": "テーブル名: sales\n- sale_id (主キー, 整数)\n- emp_id (社員ID, 整数)\n- quantity (数量, 整数)\n- sale_date (日付, 例: '2025-02-01')\nテーブル名: employees\n- emp_id, dept_id\nテーブル名: departments\n- dept_id, dept_name",
            "solutionPatterns": ["SELECT\\s+SUM\\(quantity\\)\\s+FROM\\s+sales\\s+WHERE\\s+emp_id\\s+IN\\s*\\(\\s*SELECT\\s+emp_id\\s+FROM\\s+employees\\s+WHERE\\s+dept_id\\s*=\\s*\\(\\s*SELECT\\s+dept_id\\s+FROM\\s+departments\\s+WHERE\\s+dept_name\\s*=\\s*'開発部'\\s*\\)\\s*\\)"],
            "answer": "SELECT SUM(quantity) FROM sales WHERE emp_id IN (SELECT emp_id FROM employees WHERE dept_id = (SELECT dept_id FROM departments WHERE dept_name = '開発部'))",
            "borrowed": ["SUM", "IN"],
            "reward": {
                "gold": 300,
                "energy": 5,
                "items": ["SUM", "IN"]
            },
            "hint": "`WHERE`句の中に別の`SELECT`文（サブクエリ）を入れることで、段階的に条件を絞り込める。"
        },
        {
            "floor": 5,
            "title": "ボス戦！ ゴーレム・オブ・セールス",
            "story": "ボス戦だ！部署ごとに、2025年2月以降の売上数量(quantity)の合計を求めよ。ただし合計数量が10未満の部署は表示しないこと。",
            "schema": "テーブル名: sales\n- emp_id, quantity, sale_date\nテーブル名: employees\n- emp_id, dept_id\nテーブル名: departments\n- dept_id, dept_name",
            "specialValidation": true,
            "answer": "SELECT dept_name, SUM(quantity) FROM sales INNER JOIN employees ON sales.emp_id = employees.emp_id INNER JOIN departments ON employees.dept_id = departments.dept_id WHERE sale_date >= '2025-02-01' GROUP BY dept_name HAVING SUM(quantity) >= 10",
            "borrowed": ["HAVING"],
            "reward": {
                "gold": 500,
                "energy": 10,
                "items": []
            },
            "hint": "3つのテーブルをJOINし、WHEREで日付を絞り、GROUP BYで集計し、HAVINGで最終絞込を行うのだ！",
            "opensShop": true
        }
    ]
}